From 0f1a0c762c5429dd2090431ba24dff517db01e0f Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Sat, 21 Mar 2020 17:56:43 +0100
Subject: [PATCH 1/7] Sets Docker push to public repo.

---
 .github/workflows/ingsw1920.yml | 34 ++++++++++-----------------------
 1 file changed, 10 insertions(+), 24 deletions(-)

diff --git a/.github/workflows/ingsw1920.yml b/.github/workflows/ingsw1920.yml
index d0deb49..88fe0d2 100644
--- a/.github/workflows/ingsw1920.yml
+++ b/.github/workflows/ingsw1920.yml
@@ -11,8 +11,6 @@ jobs:
   gradleTasksAndDockerPush:
     
     runs-on: ubuntu-latest
-    env:
-      IMAGE_NAME: ingsw1920 # must be lowercase
     
     steps:
 
@@ -29,10 +27,6 @@ jobs:
     - name: Grant execute permission for gradlew
       run: chmod +x gradlew
 
-      # Gradle check task
-    - name: Invoke gradle task - CHECK
-      run: ./gradlew check
-
       # Gradle build task
     - name: Invoke gradle task - BUILD
       run: ./gradlew build
@@ -49,31 +43,23 @@ jobs:
 
       # Build Docker image
     - name: Build image
-      run: docker build . --file Dockerfile --tag image
+      run: docker image build . --file Dockerfile --tag image
 
       # Log into registry (DockerHub)
     - name: Log into registry
-      run: echo "${{ secrets.GITHUB_ACCESS_TOKEN }}" | docker login docker.pkg.github.com -u ${{ github.actor }} --password-stdin
+      run: echo "${{ secrets.PACKAGES_TOKEN }}" | docker login docker.pkg.github.com -u ${{ secrets.PACKAGES_USER }} --password-stdin
 
       # Build Docker image and push it to DockerHub
     - name: Push image
       run: |
-        IMAGE_ID=docker.pkg.github.com/${{ github.repository }}/$IMAGE_NAME
-        
-        # Strip git ref prefix from version
-        VERSION=$(echo "${{ github.ref }}" | sed -e 's,.*/\(.*\),\1,')
-        
-        # Strip "v" prefix from tag name
-        [[ "${{ github.ref }}" == "refs/tags/"* ]] && VERSION=$(echo $VERSION | sed -e 's/^v//')
+        IMAGE_NAME="$(echo $GITHUB_REPOSITORY | cut -d'/' -f 2 | cut -d'-' -f 2)"
+        IMAGE_ID=docker.pkg.github.com/softeng1920-inf-uniba/docker_prova/$IMAGE_NAME
         
-        # Use Docker `latest` tag convention
-        [ "$VERSION" == "master" ] && VERSION=latest
+        # Convert IMAGE_ID to lowercase (repository name must be lowercase)
+        IMAGE_ID=$(echo "$IMAGE_ID" | tr "[:upper:]" "[:lower:]")
 
-        # Convert IMAGE_ID and VERSION to lowercase (repository name must be lowercase)
-        IMAGE_ID=$(echo "$IMAGE_ID" | awk '{print tolower($0)}')
-        VERSION=$(echo "$VERSION" | awk '{print tolower($0)}')
+        docker tag image $IMAGE_ID:latest
+        docker push $IMAGE_ID:latest
 
-        echo IMAGE_ID=$IMAGE_ID
-        echo VERSION=$VERSION
-        docker tag image $IMAGE_ID:$VERSION
-        docker push $IMAGE_ID:$VERSION
\ No newline at end of file
+
+        
-- 
2.21.1 (Apple Git-122.3)


From d984fef82971a6031d9520eb3ba8984ceb1c1a02 Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Sat, 21 Mar 2020 18:02:21 +0100
Subject: [PATCH 2/7] Removes trailing whitespace from `ingsw1920.yml`

---
 .github/workflows/ingsw1920.yml | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/.github/workflows/ingsw1920.yml b/.github/workflows/ingsw1920.yml
index 88fe0d2..2fa8fe1 100644
--- a/.github/workflows/ingsw1920.yml
+++ b/.github/workflows/ingsw1920.yml
@@ -59,7 +59,4 @@ jobs:
         IMAGE_ID=$(echo "$IMAGE_ID" | tr "[:upper:]" "[:lower:]")
 
         docker tag image $IMAGE_ID:latest
-        docker push $IMAGE_ID:latest
-
-
-        
+        docker push $IMAGE_ID:latest
\ No newline at end of file
-- 
2.21.1 (Apple Git-122.3)


From 7422ef067f4752b30a087e7394fb32edbc3e10a8 Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Sun, 22 Mar 2020 22:11:22 +0100
Subject: [PATCH 3/7] Little edit in README.md

---
 README.md | 1 +
 1 file changed, 1 insertion(+)

diff --git a/README.md b/README.md
index 3374568..60bf77a 100644
--- a/README.md
+++ b/README.md
@@ -33,6 +33,7 @@ La struttura della repository si presenta nel seguente modo:
 |–– settings.gradle
 ```
 
+
 Nel seguito si dettagliano i ruoli dei diversi componenti:
 - **.github/workflows/ingsw1920.yml**: dettaglia le direttive per assicurare la *continuous integration* attraverso l’uso di GitHub Actions;
 - **build**: ospita la sottocartella *reports*, contenente gli output dei tool automatici di test e controllo di qualità;
-- 
2.21.1 (Apple Git-122.3)


From 3ef6f30e2a813236639cf9c992adce25641f5744 Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Tue, 24 Mar 2020 15:07:31 +0100
Subject: [PATCH 4/7] Renames the secrets

---
 .github/workflows/ingsw1920.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/.github/workflows/ingsw1920.yml b/.github/workflows/ingsw1920.yml
index 2fa8fe1..316193a 100644
--- a/.github/workflows/ingsw1920.yml
+++ b/.github/workflows/ingsw1920.yml
@@ -47,7 +47,7 @@ jobs:
 
       # Log into registry (DockerHub)
     - name: Log into registry
-      run: echo "${{ secrets.PACKAGES_TOKEN }}" | docker login docker.pkg.github.com -u ${{ secrets.PACKAGES_USER }} --password-stdin
+      run: echo "${{ secrets.GITHUB_ACCESS_TOKEN }}" | docker login docker.pkg.github.com -u ${{ secrets.GITHUB_USERNAME }} --password-stdin
 
       # Build Docker image and push it to DockerHub
     - name: Push image
-- 
2.21.1 (Apple Git-122.3)


From 7a36f84fba4d11feea94febcbc371a23bc51d70c Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Tue, 24 Mar 2020 15:40:40 +0100
Subject: [PATCH 5/7] Sets the actual destination for the Docker images
 produced by the workflow.

---
 .github/workflows/ingsw1920.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/.github/workflows/ingsw1920.yml b/.github/workflows/ingsw1920.yml
index 316193a..a4c7435 100644
--- a/.github/workflows/ingsw1920.yml
+++ b/.github/workflows/ingsw1920.yml
@@ -53,7 +53,7 @@ jobs:
     - name: Push image
       run: |
         IMAGE_NAME="$(echo $GITHUB_REPOSITORY | cut -d'/' -f 2 | cut -d'-' -f 2)"
-        IMAGE_ID=docker.pkg.github.com/softeng1920-inf-uniba/docker_prova/$IMAGE_NAME
+        IMAGE_ID=docker.pkg.github.com/softeng1920-inf-uniba/docker_1920/$IMAGE_NAME
         
         # Convert IMAGE_ID to lowercase (repository name must be lowercase)
         IMAGE_ID=$(echo "$IMAGE_ID" | tr "[:upper:]" "[:lower:]")
-- 
2.21.1 (Apple Git-122.3)


From bed8d94410c5eecfc8d783c8567f2d93544c0b5d Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Tue, 24 Mar 2020 16:30:14 +0100
Subject: [PATCH 6/7] Little refinement in README.md

---
 README.md | 1 -
 1 file changed, 1 deletion(-)

diff --git a/README.md b/README.md
index 60bf77a..3374568 100644
--- a/README.md
+++ b/README.md
@@ -33,7 +33,6 @@ La struttura della repository si presenta nel seguente modo:
 |–– settings.gradle
 ```
 
-
 Nel seguito si dettagliano i ruoli dei diversi componenti:
 - **.github/workflows/ingsw1920.yml**: dettaglia le direttive per assicurare la *continuous integration* attraverso l’uso di GitHub Actions;
 - **build**: ospita la sottocartella *reports*, contenente gli output dei tool automatici di test e controllo di qualità;
-- 
2.21.1 (Apple Git-122.3)


From f3c2bcd3e55db34962d113a71a44428cc0657bd9 Mon Sep 17 00:00:00 2001
From: Luigi Quaranta <quarantalgu@gmail.com>
Date: Tue, 24 Mar 2020 18:04:06 +0100
Subject: [PATCH 7/7] Limits GitHub Actions activation to pull request events.

---
 .github/workflows/ingsw1920.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/.github/workflows/ingsw1920.yml b/.github/workflows/ingsw1920.yml
index a4c7435..2750103 100644
--- a/.github/workflows/ingsw1920.yml
+++ b/.github/workflows/ingsw1920.yml
@@ -1,6 +1,6 @@
 name: Gradle Check&Build + Image Push on GitHub Packages
 
-on: [ push, pull_request ]
+on: [ pull_request ]
 
 jobs:
 
-- 
2.21.1 (Apple Git-122.3)

